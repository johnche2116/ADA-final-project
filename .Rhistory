chd = factor(MCQ160B, levels = c(1,2), labels = c("Yes", "No")),
stroke = factor(MCQ160C, levels = c(1,2), labels = c("Yes", "No"))
)
merged_data <- merged_data %>%
mutate(
comorbidity = factor(ifelse(MCQ160A == 1 | MCQ160B == 1 | MCQ160C == 1, "Yes", "No"))
)
final_data <- merged_data %>%
filter(!is.na(SBP_avg), !is.na(DBP_avg), !is.na(hypertension),
!is.na(bp_controlled), !is.na(pa_level), !is.na(sex),
!is.na(RIDAGEYR), !is.na(duration_diabetes), !is.na(diabetes_med))
final_data <- merged_data %>%
filter(!is.na(pa_level), !is.na(sex)),
final_data <- merged_data %>%
filter
(!is.na(pa_level), !is.na(sex)),
final_data <- merged_data %>%
filter(!is.na(pa_level),
!is.na(sex)),
write.csv(final_data, "all includedNHANES_2021_2023_final.csv", row.names = FALSE)
library(haven)
library(dplyr)
library(survey)
demo <- read_xpt("DEMO_L.XPT")
bmx  <- read_xpt("BMX_L.XPT")
ghb  <- read_xpt("GHB_L.XPT")
diq  <- read_xpt("DIQ_L.XPT")
paq  <- read_xpt("PAQ_L.XPT")
smq  <- read_xpt("SMQ_L.XPT")
alq  <- read_xpt("ALQ_L.XPT")
hiq  <- read_xpt("HIQ_L.XPT")
mcq  <- read_xpt("MCQ_L.XPT")
merged_data <- demo %>%
left_join(bmx, by = "SEQN") %>%
left_join(ghb, by = "SEQN") %>%
left_join(diq, by = "SEQN") %>%
left_join(paq, by = "SEQN") %>%
left_join(smq, by = "SEQN") %>%
left_join(alq, by = "SEQN") %>%
left_join(hiq, by = "SEQN") %>%
left_join(mcq, by = "SEQN")
diabetes_data <- merged_data %>%
filter(RIDAGEYR >= 18, DIQ010 == 1)
clean_data <- diabetes_data %>%
mutate(
poor_glycemic = ifelse(LBXGH >= 7, 1, 0),
pa_total_min = ifelse(!is.na(PAD615) | !is.na(PAD630),
rowSums(cbind(PAD615*2, PAD630), na.rm = TRUE), NA),
pa_level = ifelse(pa_total_min >= 150, "Meets", "NotMeets"),
smoking = ifelse(SMQ020 == 1, "Yes",
ifelse(SMQ020 == 2, "No", NA)),
alcohol = ifelse(ALQ111 == 1, "Yes",
ifelse(ALQ111 == 2, "No", NA)),
insured = ifelse(HIQ011 == 1, "Yes",
ifelse(HIQ011 == 2, "No", NA)),
comorbidity = ifelse(MCQ160E == 1 | MCQ160C == 1 | MCQ160F == 1, "Yes", "No"),
sex = factor(RIAGENDR, levels = c(1, 2), labels = c("Male", "Female")),
race = factor(RIDRETH3),
education = factor(DMDEDUC2),
insurance = factor(insured),
smoker = factor(smoking),
drinker = factor(alcohol),
pa_guideline = factor(pa_level),
comorb = factor(comorbidity)
)
names(paq)
vigorous_weekly = PAD790Q * PAD790U,
vigorous_weekly = PAD790Q * PAD790U,
moderate_weekly = PAD810Q * PAD810U,
pa_total_min = ifelse(!is.na(PAD790Q) | !is.na(PAD810Q),
rowSums(cbind(PAD790Q * PAD790U, PAD810Q * PAD810U), na.rm = TRUE),
NA),
pa_total_min = ifelse(!is.na(PAD790Q) | !is.na(PAD810Q),
rowSums(cbind(PAD790Q * PAD790U, PAD810Q * PAD810U), na.rm = TRUE),
NA)
paq <- paq %>%
mutate(
pa_total_min = ifelse(!is.na(PAD790Q) | !is.na(PAD810Q),
rowSums(cbind(PAD790Q * PAD790U, PAD810Q * PAD810U), na.rm = TRUE),
NA),
pa_level = ifelse(pa_total_min >= 150, "Meets", "NotMeets")
)
merged_data <- merged_data %>%
left_join(paq %>%
select(SEQN, PAD790Q, PAD790U, PAD810Q, PAD810U),
by = "SEQN") %>%
mutate(
pa_total_min = ifelse(!is.na(PAD790Q) | !is.na(PAD810Q),
rowSums(cbind(PAD790Q * PAD790U, PAD810Q * PAD810U), na.rm = TRUE),
NA),
pa_level = ifelse(pa_total_min >= 150, "Meets", "NotMeets")
)
library(dplyr)
library(tableone)
install.packages("tableone")
library(tableone)
outcome <- "poor_glycemic"  # 1 = poor control, 0 = good control
categorical_vars <- c("comorb", "insurance", "education", "race", "smoker", "drinker", "pa_guideline")
continuous_vars  <- c("RIDAGEYR", "BMXBMI", "INDFMPIR")
table1 <- CreateTableOne(vars = c(categorical_vars, continuous_vars),
strata = outcome,
data = final_data,  # your cleaned dataset
factorVars = categorical_vars)
table1 <- CreateTableOne(vars = c(categorical_vars, continuous_vars),
strata = outcome,
data = final_data,  # your cleaned dataset
factorVars = categorical_vars)
final_data <- merged_data %>%
filter(!is.na(poor_glycemic),
!is.na(RIDAGEYR),
!is.na(BMXBMI),
!is.na(comorb),
!is.na(insurance),
!is.na(education),
!is.na(race),
!is.na(smoker),
!is.na(drinker),
!is.na(pa_guideline))
if(!require(tableone)) install.packages("tableone")
library(tableone)
outcome <- "poor_glycemic"
categorical_vars <- c("comorb", "insurance", "education", "race",
"smoker", "drinker", "pa_guideline")
continuous_vars <- c("RIDAGEYR", "BMXBMI", "INDFMPIR")
table1 <- CreateTableOne(vars = c(categorical_vars, continuous_vars),
strata = outcome,
data = final_data,
factorVars = categorical_vars)
ls()
final_data <- read.csv("path/to/your/final_data.csv")
final_data <- read.csv("C:/Users/ryzen7/Documents/final_data.csv", stringsAsFactors = FALSE)
table1 <- CreateTableOne(vars = c(categorical_vars, continuous_vars),
strata = outcome,
data = final_data,
factorVars = categorical_vars)
library(dplyr)
library(tableone)
data <- read.csv("/mnt/data/56a7e911-1c01-4595-8145-47d4ff979b23.csv")
final_data <- read.csv("C:/Users/ryzen7/Documents/final_data.csv", stringsAsFactors = FALSE)
head(data)
str(data)
str(data)
categorical_vars <- c("var1", "var2")
continuous_vars <- c("var3", "var4")
desc_table <- CreateTableOne(vars = c(categorical_vars, continuous_vars),
data = data,
factorVars = categorical_vars)
install.packages("tableone")
library(tableone)
install.packages("tableone")
install.packages("tableone")
library(tableone)
categorical_vars <- c("sex", "race", "pa_level", "smoking", "alcohol",
"education", "health_insurance", "comorbidity")
continuous_vars <- c("RIDAGEYR", "BMXBMI", "INDFMPIR")
table1 <- CreateTableOne(vars = c(categorical_vars, continuous_vars),
strata = "poor_glycemic",
data = your_data_frame,
factorVars = categorical_vars)
print(table1, showAllLevels = TRUE)
"tidyverse","metafor","revtools","PRISMA2020","readr","boot",
install.packages(setdiff(required_pkgs, rownames(installed.packages())))
# Define required packages
required_pkgs <- c(
"tidyverse",
"metafor",
"revtools",
"PRISMA2020",
"readr",
"boot",
"knitr",
"kableExtra",
"ggplot2",
"meta",
"dmetar",
"robumeta"
)
# Install only packages not already installed
install.packages(setdiff(required_pkgs, rownames(installed.packages())))
library(tidyverse)
library(metafor)
library(revtools)
library(PRISMA2020)
library(readr)
library(boot)
library(knitr)
library(kableExtra)
library(ggplot2)
library(meta)
library(dmetar)
extraction_template <- tibble(
StudyID = character(),
Year = integer(),
Design = character(),
N_PRRT = integer(),
N_Suni = integer(),
OS_HR = numeric(),
OS_Lower95 = numeric(),
OS_Upper95 = numeric(),
PFS_HR = numeric(),
PFS_Lower95 = numeric(),
PFS_Upper95 = numeric(),
Cost_PRRT = numeric(),
Cost_PRRT_SD = numeric(),
Cost_Suni = numeric(),
Cost_Suni_SD = numeric(),
QALY_PRRT = numeric(),
QALY_PRRT_SD = numeric(),
QALY_Suni = numeric(),
QALY_Suni_SD = numeric(),
QoL_measure = character(),
Notes = character()
)
write_csv(extraction_template, "extracted_data_template.csv")
library(tidyverse)
library(survey)
library(srvyr)
library(foreign)
library(car)
demo <- read.xport("P_DEMO.xpt")
demo <- read.xport("P_DEMO.xpt")
bpx  <- read.xport("P_BPXO.xpt")
paq  <- read.xport("P_PAQ.xpt")
bmx  <- read.xport("P_BMX.xpt")
smq  <- read.xport("P_SMQ.xpt")
alq  <- read.xport("P_ALQ.xpt")
diq  <- read.xport("P_DIQ.xpt")
nhanes <- demo %>%
left_join(bpx, by = "SEQN") %>%
left_join(paq, by = "SEQN") %>%
left_join(bmx, by = "SEQN") %>%
left_join(smq, by = "SEQN") %>%
left_join(alq, by = "SEQN") %>%
left_join(diq, by = "SEQN")
nhanes <- nhanes %>% filter(RIDAGEYR >= 18)
nhanes <- nhanes %>%
mutate(
mean_sbp = rowMeans(select(., BPXSY1, BPXSY2, BPXSY3), na.rm = TRUE),
mean_dbp = rowMeans(select(., BPXDI1, BPXDI2, BPXDI3), na.rm = TRUE)
)
names(nhanes)
nhanes <- nhanes %>%
mutate(
mean_sbp = rowMeans(select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),
mean_dbp = rowMeans(select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE)
)
nhanes <- nhanes %>%
mutate(
bp_control = ifelse(mean_sbp < 130 & mean_dbp < 80, 1, 0)
)
nhanes <- nhanes %>%
mutate(
mod_min = ifelse(is.na(PAD615), 0, PAD615),
vig_min = ifelse(is.na(PAD630), 0, PAD630),
mvpa_min = mod_min + (2 * vig_min),   # vigorous counts double
meet_pa = ifelse(mvpa_min >= 150, 1, 0)
)
nhanes <- nhanes %>%
filter(RIDAGEYR >= 18)
library(survey)
nhanes_design <- svydesign(
ids = ~SDMVPSU,
strata = ~SDMVSTRA,
weights = ~WTMEC2YR,
nest = TRUE,
data = nhanes
)
names(nhanes)
"WTMEC2YR" %in% names(nhanes)
nhanes_design <- svydesign(
ids = ~SDMVPSU,
strata = ~SDMVSTRA,
weights = ~WTMECPRP,
nest = TRUE,
data = nhanes
)
nhanes_design
summary(nhanes_design)
svymean(~bp_control, nhanes_design, na.rm = TRUE)
model <- svyglm(
bp_control ~ meet_pa + RIDAGEYR + factor(RIAGENDR) + factor(RIDRETH1),
design = nhanes_design,
family = quasibinomial()
)
summary(model)
model_mvpa <- svyglm(
bp_control ~ mvpa_min + RIDAGEYR + factor(RIAGENDR) + factor(RIDRETH1),
design = nhanes_design,
family = quasibinomial()
)
summary(model_mvpa)
svymean(~mean_sbp + mean_dbp + RIDAGEYR + BMXBMI, nhanes_design, na.rm = TRUE)
svytable(~meet_pa + bp_control, nhanes_design)
library(broom)
tidy(model)
tidy(model_mvpa)
library(readr)
library(writexl)
tidy(model)
tidy(model_mvpa)
tidy(model) %>%
write_csv("bp_control_model.csv")
tidy(model) %>%
write_csv("bp_control_model.csv")
tidy(model_mvpa) %>%
write_csv("bp_control_model_mvpa.csv")
library(officer)
install.packages("officer")
library(flextable)
install.packages("flextable")
library(flextable)
doc <- read_docx()
doc <- read_docx()
library(officer)
library(flextable)
doc <- read_docx()
doc <- doc %>%
body_add_par("Logistic Regression: Binary PA", style = "heading 1") %>%
body_add_flextable(flextable(tidy(model)))
doc <- doc %>%
body_add_par("Weighted Means", style = "heading 1") %>%
body_add_flextable(flextable(weighted_means_df))
library(survey)
weighted_means <- svymean(~mean_sbp + mean_dbp + RIDAGEYR + BMXBMI, nhanes_design, na.rm = TRUE)
weighted_means_df <- as.data.frame(weighted_means)
doc <- doc %>%
body_add_par("Weighted Means", style = "heading 1") %>%
body_add_flextable(flextable(weighted_means_df))
doc <- doc %>%
body_add_par("PA vs BP Control Crosstab", style = "heading 1") %>%
body_add_flextable(flextable(weighted_table_df))
doc <- doc %>%
body_add_par("Weighted Means", style = "heading 1") %>%
body_add_flextable(flextable(weighted_means_df))
doc <- doc %>%
body_add_par("PA vs BP Control Crosstab", style = "heading 1") %>%
body_add_flextable(flextable(weighted_table_df))
weighted_means <- svymean(~mean_sbp + mean_dbp + RIDAGEYR + BMXBMI, nhanes_design, na.rm = TRUE)
weighted_means_df <- as.data.frame(weighted_means)
doc <- doc %>%
body_add_par("PA vs BP Control Crosstab", style = "heading 1") %>%
body_add_flextable(flextable(weighted_table_df))
weighted_table <- svytable(~meet_pa + bp_control, nhanes_design)
weighted_table_df <- as.data.frame(weighted_table)
doc <- doc %>%
body_add_par("PA vs BP Control Crosstab", style = "heading 1") %>%
body_add_flextable(flextable(weighted_table_df))
print(doc, target = "All fileNHANES_BP_PA_results.docx")
library(tidyverse)
library(survey)
library(srvyr)
library(foreign)
library(broom)
library(readr)
library(writexl)
demo <- read.xport("P_DEMO.xpt")
bpx  <- read.xport("P_BPXO.xpt")
paq  <- read.xport("P_PAQ.xpt")
bmx  <- read.xport("P_BMX.xpt")
smq  <- read.xport("P_SMQ.xpt")
alq  <- read.xport("P_ALQ.xpt")
diq  <- read.xport("P_DIQ.xpt")
nhanes <- demo %>%
left_join(bpx, by = "SEQN") %>%
left_join(paq, by = "SEQN") %>%
left_join(bmx, by = "SEQN") %>%
left_join(smq, by = "SEQN") %>%
left_join(alq, by = "SEQN") %>%
left_join(diq, by = "SEQN")
nhanes <- nhanes %>% filter(RIDAGEYR >= 18)
nhanes <- nhanes %>%
mutate(
mean_sbp = rowMeans(select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),
mean_dbp = rowMeans(select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE),
bp_control = ifelse(mean_sbp < 130 & mean_dbp < 80, 1, 0)
)
nhanes <- nhanes %>%
mutate(
mod_min = ifelse(is.na(PAD615), 0, PAD615),
vig_min = ifelse(is.na(PAD630), 0, PAD630),
mvpa_min = mod_min + (2 * vig_min),
meet_pa = ifelse(mvpa_min >= 150, 1, 0)
)
nhanes_design <- svydesign(
ids = ~SDMVPSU,
strata = ~SDMVSTRA,
weights = ~WTMECPRP,
nest = TRUE,
data = nhanes
)
weighted_means <- svymean(~mean_sbp + mean_dbp + RIDAGEYR + BMXBMI, nhanes_design, na.rm = TRUE)
weighted_means_df <- as.data.frame(weighted_means)
names(weighted_means_df) <- c("Mean", "SE")
weighted_means_df$Variable <- rownames(weighted_means_df)
weighted_means_df <- weighted_means_df[, c("Variable", "Mean", "SE")]
weighted_table <- svytable(~meet_pa + bp_control, nhanes_design)
weighted_table_df <- as.data.frame(weighted_table)
names(weighted_table_df) <- c("meet_pa", "bp_control", "Weighted_Count")
model_pr <- svyglm(
bp_control ~ meet_pa + RIDAGEYR + factor(RIAGENDR) + factor(RIDRETH1) +
BMXBMI + SMQ020 + ALQ111 + DIQ010,  # include BMI, smoking, alcohol, diabetes
design = nhanes_design,
family = quasipoisson(link = "log")
)
pr_estimates <- exp(cbind(PR = coef(model_pr), confint(model_pr)))
model_inter <- svyglm(
bp_control ~ meet_pa * factor(RIAGENDR) + meet_pa * BMXBMI + RIDAGEYR + factor(RIDRETH1) +
SMQ020 + ALQ111 + DIQ010,
design = nhanes_design,
family = quasipoisson(link = "log")
)
pr_inter_estimates <- exp(cbind(PR = coef(model_inter), confint(model_inter)))
write_xlsx(list(
"Main Model PR" = as.data.frame(pr_estimates),
"Interaction Model PR" = as.data.frame(pr_inter_estimates)
), "BP_Control_PR_Models.xlsx")
write_xlsx(list(
"Weighted Means" = weighted_means_df,
"PA vs BP Crosstab" = weighted_table_df
), "BP_Control_Descriptive.xlsx")
library(officer)
library(flextable)
doc <- read_docx()
doc <- doc %>%
body_add_par("Weighted Means of Continuous Variables", style = "heading 1") %>%
body_add_flextable(flextable(weighted_means_df))
doc <- doc %>%
body_add_par("PA vs BP Control Crosstab", style = "heading 1") %>%
body_add_flextable(flextable(weighted_table_df))
doc <- doc %>%
body_add_par("Main Model: Prevalence Ratios (PRs)", style = "heading 1") %>%
body_add_flextable(flextable(as.data.frame(pr_estimates)))
doc <- doc %>%
body_add_par("Interaction Model: Prevalence Ratios (PRs)", style = "heading 1") %>%
body_add_flextable(flextable(as.data.frame(pr_inter_estimates)))
print(doc, target = "poissonNHANES_BP_PA_Results.docx")
library(tidyverse)
library(survey)
library(foreign)
library(broom)
library(readr)
demo <- read.xport("data/P_DEMO.xpt")
nhanes <- demo %>%
left_join(bpx, by = "SEQN") %>%
left_join(paq, by = "SEQN") %>%
left_join(bmx, by = "SEQN") %>%
left_join(smq, by = "SEQN") %>%
left_join(alq, by = "SEQN") %>%
left_join(diq, by = "SEQN")
nhanes <- nhanes %>% filter(RIDAGEYR >= 18)
nhanes <- nhanes %>%
mutate(
mean_sbp = rowMeans(select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),
mean_dbp = rowMeans(select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE),
bp_control = ifelse(mean_sbp < 130 & mean_dbp < 80, 1, 0)
)
nhanes <- nhanes %>%
mutate(
mod_min = ifelse(is.na(PAD615), 0, PAD615),
vig_min = ifelse(is.na(PAD630), 0, PAD630),
mvpa_min = mod_min + (2 * vig_min),
meet_pa = ifelse(mvpa_min >= 150, 1, 0)
)
nhanes_design <- svydesign(
ids = ~SDMVPSU,
strata = ~SDMVSTRA,
weights = ~WTMECPRP,
nest = TRUE,
data = nhanes
)
weighted_means <- svymean(~mean_sbp + mean_dbp + RIDAGEYR + BMXBMI, nhanes_design, na.rm = TRUE)
weighted_means_df <- as.data.frame(weighted_means)
names(weighted_means_df) <- c("Mean", "SE")
weighted_means_df$Variable <- rownames(weighted_means_df)
weighted_means_df <- weighted_means_df[, c("Variable", "Mean", "SE")]
write.csv(weighted_means_df, "outputs/Weighted_Means.csv", row.names = FALSE)
write.csv(weighted_means_df, "outputs/Weighted_Means.csv", row.names = FALSE)
weighted_table <- svytable(~meet_pa + bp_control, nhanes_design)
weighted_table_df <- as.data.frame(weighted_table)
names(weighted_table_df) <- c("meet_pa", "bp_control", "Weighted_Count")
write.csv(weighted_table_df, "outputs/PA_vs_BP_Crosstab.csv", row.names = FALSE)
model_pr <- svyglm(
bp_control ~ meet_pa + RIDAGEYR + factor(RIAGENDR) + factor(RIDRETH1) +
BMXBMI + SMQ020 + ALQ111 + DIQ010,
design = nhanes_design,
family = quasipoisson(link = "log")
)
pr_estimates <- exp(cbind(PR = coef(model_pr), confint(model_pr)))
write.csv(as.data.frame(pr_estimates), "outputs/BP_Control_MainModel_PR.csv", row.names = TRUE)
model_inter <- svyglm(
bp_control ~ meet_pa * factor(RIAGENDR) + meet_pa * BMXBMI + RIDAGEYR +
factor(RIDRETH1) + SMQ020 + ALQ111 + DIQ010,
design = nhanes_design,
family = quasipoisson(link = "log")
)
pr_inter_estimates <- exp(cbind(PR = coef(model_inter), confint(model_inter)))
write.csv(as.data.frame(pr_inter_estimates), "outputs/BP_Control_InteractionModel_PR.csv", row.names = TRUE)
setwd("C:/path/to/ADA-final-project")
setwd("C:/Users/ryzen7/Documents/ADA-final-project")
getwd()
if(!dir.exists("outputs")) dir.create("outputs")
if(!dir.exists("outputs")) dir.create("outputs")
write.csv(weighted_means_df, "outputs/Weighted_Means.csv", row.names = FALSE)
write.csv(weighted_table_df, "outputs/PA_vs_BP_Crosstab.csv", row.names = FALSE)
write.csv(as.data.frame(pr_estimates), "outputs/BP_Control_MainModel_PR.csv", row.names = TRUE)
write.csv(as.data.frame(pr_inter_estimates), "outputs/BP_Control_InteractionModel_PR.csv", row.names = TRUE)
C:/Users/ryzen7/Documents/ADA-final-project/outputs/
C:/Users/ryzen7/Documents/ADA-final-project/outputs/
cd "C:/Users/ryzen7/Documents/ADA-final-project"
cd "C:/Users/ryzen7/Documents/ADA-final-project"
cd "C:/Users/ryzen7/Documents/ADA-final-project"
cd "C:/Users/ryzen7/Documents/ADA-final-project"
